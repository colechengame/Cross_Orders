# Cross Orders - BU 跨集團訂單轉移系統

> **版本**: v2.0
> **最後更新**: 2024-11-12
> **技術棧**: Next.js 15 + React 19 + TypeScript + Tailwind CSS

---

## 📖 專案簡介

Cross Orders 是一個專為多 BU（Business Unit）醫美體系設計的跨集團訂單轉移與課程消耗管理系統。本系統旨在簡化跨 BU 課程消耗流程，實現訂單自動轉移，並提供完整的會員綁定機制。

### 業務背景

**適用場景**:
- BU3（愛美肌）銷售訂單給客戶
- 客戶到 BU1（板橋醫美）或 BU4（漾澤）實際消費課程
- 需要跨 BU 進行課程消耗與訂單管理

**核心挑戰**:
- ❌ 每次消耗都需要複雜的跨轉流程
- ❌ 操作步驟繁瑣（6-7 步）
- ❌ 需要在多個系統間切換
- ❌ 人工介入率高，效率低

**解決方案**:
- ✅ BU 切換搜尋：一個介面搜尋所有 BU 會員
- ✅ 智能會員綁定：兩階段綁定機制（自動關聯 + 強綁定）
- ✅ 自動訂單轉移：首次轉移，後續直接消耗
- ✅ 統一操作介面：減少系統切換，提升效率 90%+

---

## ✨ 核心功能

### 1. BU 切換搜尋

```
傳統方式：只能搜本店會員 → 需切換系統或詢問
優化後：  下拉選單切換 BU → 搜尋任意 BU 會員
```

**特點**:
- 🔍 支持跨 BU 會員搜尋
- 🎯 智能模糊匹配（姓名相似度、手機後 4 碼）
- ⚡ 一鍵關聯功能
- 📊 顯示會員相似度評分

---

### 2. 兩階段會員綁定機制

#### 第一階段：系統自動配對關聯

```typescript
條件：姓名 + 手機號碼完全一致
觸發：系統自動
同步：❌ 不同步會員資料
適用：偶爾跨轉消費的會員
```

#### 第二階段：人工驗證強綁定

```typescript
條件：已通過第一階段關聯
觸發：操作者/使用者手動點選
同步：✅ 強制雙向同步會員資料
適用：頻繁跨轉消費的會員
```

**效果對比**:

| 項目 | 第一階段 | 第二階段 |
|------|---------|---------|
| 資料同步 | ❌ | ✅ |
| 後續維護 | 各 BU 獨立 | 自動同步 |
| 適用場景 | 偶爾消費 | 頻繁消費 |

---

### 3. 自動訂單轉移

**核心價值**:
- 首次消耗時可選擇將訂單從銷售 BU 轉移到消費 BU
- 轉移後訂單歸屬消費 BU，後續消耗無需跨轉流程

**效率提升**:

| 場景 | 傳統方式 | 優化後 | 改善 |
|------|---------|--------|------|
| 首次消耗 | 5-10 分鐘 | 1 分鐘 | ⬇️ 80-90% |
| 第 2 次消耗 | 5-10 分鐘 | 10 秒 | ⬇️ 98% |
| 第 3-5 次 | 每次 5-10 分鐘 | 每次 10 秒 | ⬇️ 98% |
| **總耗時（5 次）** | **25-50 分鐘** | **1.5 分鐘** | **⬇️ 94-97%** |

---

### 4. 跨轉單專員工作台

**主要功能**:
- 📋 待處理清單（無關聯、部分關聯會員）
- 🔄 批量處理功能
- 💡 智能提示系統（推薦操作、風險提示）
- 📞 快速聯繫功能（電話、Line、Email）
- 📊 處理統計與分析

**效果**:
- 人工介入率：30% → 5%（⬇️ 83%）
- 專員工作量：⬇️ 70%
- 處理準確率：85% → 98%（⬆️ 15%）

---

### 5. 財務結算報表

**功能**:
- 📊 訂單轉移統計（轉出/轉入）
- 💰 財務結算自動計算
- 📄 報表匯出（Excel/PDF）
- 🔍 完整轉移歷史追蹤

---

## 🏗️ 技術架構

### 前端技術棧

```
Next.js 15          - React 框架
React 19            - UI 框架
TypeScript          - 類型安全
Tailwind CSS        - 樣式系統
```

### 核心數據結構

```typescript
// 訂單模型（擴展）
interface IOrder {
  id: string;
  memberName: string;
  phone: string;
  store: string;                    // 當前管理門市
  items: IOrderItem[];

  // 新增：訂單轉移相關
  originalStore?: string;           // 原始銷售門市
  transferredFrom?: string;         // 從哪個門市轉入
  transferredTo?: string;           // 轉出到哪個門市
  transferDate?: string;            // 轉移日期
  isTransferred: boolean;           // 是否已轉移
}

// 會員綁定模型（第一階段）
interface IMemberAutoLink {
  linkId: string;
  linkType: 'auto';
  linkStatus: 'linked';
  syncEnabled: false;               // 不同步資料
  bu3: IMemberInfo;
  bu1: IMemberInfo;
}

// 會員綁定模型（第二階段）
interface IMemberStrongLink {
  linkId: string;
  linkType: 'strong';
  linkStatus: 'strong-linked';
  syncEnabled: true;                // 啟用同步
  syncDirection: 'bidirectional';   // 雙向同步
  masterDataSource: 'bu3' | 'bu1';  // 主資料來源
  bu3: IMemberInfo;
  bu1: IMemberInfo;
}

// 訂單轉移記錄
interface IOrderTransferRecord {
  id: string;
  orderId: string;
  fromStore: string;                // 轉出門市
  toStore: string;                  // 轉入門市
  transferDate: string;
  operator: string;                 // 操作人員
  consumptionAtTransfer: {          // 轉移時消耗明細
    courseName: string;
    consumed: number;
    remainingBefore: number;
    remainingAfter: number;
  }[];
}
```

### 系統整合

```
跨轉單系統模組
    ↓
JPOS（主要系統）✅
  ├─ 自動化程度高
  ├─ 支持兩階段綁定
  └─ 實時同步

NPOS（備用系統）⚠️
  ├─ 傳統消耗流程
  ├─ 需手動操作
  └─ 作為緊急備用
```

---

## 🚀 快速開始

### 環境要求

- Node.js 18+
- npm/yarn/pnpm

### 安裝與運行

```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm run dev

# 打開瀏覽器訪問
http://localhost:3000
```

### 開發模式

```bash
# 開發模式（熱更新）
npm run dev

# 生產構建
npm run build

# 生產模式運行
npm start

# 代碼檢查
npm run lint
```

---

## 📚 文檔導航

### 核心文檔

1. **[BU訂單轉移優化方案.md](./BU訂單轉移優化方案.md)**
   - 完整的優化方案設計
   - UI/UX 設計詳解
   - 技術實現方案
   - 分階段實施計畫

2. **[現有流程分析.md](./現有流程分析.md)**
   - 現有跨轉單流程深入分析
   - 痛點識別與問題總結
   - 優化前後對比
   - 效益量化分析

3. **[會員綁定機制分析.md](./會員綁定機制分析.md)**
   - 兩階段綁定機制詳解
   - 跨轉單專員角色與職責
   - JPOS vs NPOS 系統對比
   - 資料同步機制設計

### 文檔關係圖

```
README.md（本文檔）
├─ 專案總覽
├─ 快速開始
└─ 文檔導航
    ↓
BU訂單轉移優化方案.md
├─ 詳細功能設計
├─ UI/UX 設計
└─ 技術實現
    ↓
現有流程分析.md
├─ 現狀分析
├─ 問題識別
└─ 效益對比
    ↓
會員綁定機制分析.md
├─ 綁定機制設計
├─ 專員工作台
└─ 同步機制
```

---

## 📅 開發計畫

### 階段一：會員帳號整併（Week 1-2）

**前置必要作業**:
- [ ] 掃描各 BU 重複會員帳號
- [ ] 合併同一人的多個帳號
- [ ] 確保一人一帳號原則
- [ ] 資料清理與驗證

---

### 階段二：核心功能開發（Week 3-6）

#### P0 優先級（必須）

**會員綁定機制**:
- [ ] 實現姓名 + 手機自動比對
- [ ] 建立會員關聯資料表
- [ ] 第一階段自動關聯功能
- [ ] 第二階段強綁定功能

**BU 切換搜尋**:
- [ ] 實現 BU 切換下拉選單
- [ ] 實現跨 BU 會員搜尋邏輯
- [ ] 智能模糊匹配功能
- [ ] 一鍵關聯功能

**訂單轉移**:
- [ ] 實現訂單轉移勾選框
- [ ] 實現訂單轉移核心邏輯
- [ ] 更新訂單數據結構
- [ ] 創建轉移記錄模型

#### P1 優先級（重要）

**UI/UX 優化**:
- [ ] 實現轉移成功/失敗訊息顯示
- [ ] 實現 BU3「已轉出訂單」視圖
- [ ] 實現 BU1「轉入訂單」視圖
- [ ] 實現轉入訂單的「直接消耗」功能

---

### 階段三：跨轉單專員工作台（Week 7-8）

- [ ] 待處理清單介面
- [ ] 批量處理功能
- [ ] 智能提示系統
- [ ] 快速聯繫功能
- [ ] 處理統計與分析

---

### 階段四：報表與管理（Week 9-10）

- [ ] 轉移記錄詳情彈窗
- [ ] 訂單轉移財務報表
- [ ] 報表匯出功能（Excel/PDF）
- [ ] 轉出/轉入統計面板
- [ ] 搜尋/篩選功能

---

### 階段五：測試與上線（Week 11-12）

**測試**:
- [ ] 單元測試（核心邏輯）
- [ ] 整合測試（完整流程）
- [ ] UI 測試（各種螢幕尺寸）
- [ ] 數據測試（邊界條件、異常情況）
- [ ] 性能測試（大量訂單）

**上線**:
- [ ] 生產環境部署
- [ ] 用戶培訓
- [ ] 監控與日誌
- [ ] 收集用戶反饋
- [ ] 持續優化

---

## 📊 預期效益

### 效率提升

| 指標 | 現狀 | 目標 | 改善 |
|------|------|------|------|
| **操作時間** | 5-10 分鐘/次 | 30 秒-1 分鐘 | ⬇️ 80-90% |
| **人工介入率** | 30% | 5% | ⬇️ 83% |
| **系統切換次數** | 3-4 次 | 0 次 | ⬇️ 100% |
| **整體效率** | 基準 | 提升 90%+ | ⬆️ 900%+ |

### 用戶體驗

- 客戶等待時間：從數小時 → 0（⬇️ 100%）
- 操作透明度：立即知道結果
- 後續消費：無需重複流程

### 管理效益

- 訂單管理：集中化，減少跨 BU 協調
- 財務結算：自動化報表，減少錯誤
- 數據追蹤：完整轉移歷史，易於審計

---

## 🎯 技術特點

### 性能優化

- ⚡ React 19 並發渲染
- 🔄 智能資料緩存
- 📦 代碼分割與懶加載
- 🎨 Tailwind CSS JIT 編譯

### 用戶體驗

- 🌓 深色/淺色主題切換
- 📱 響應式設計（支持各種設備）
- ♿ 可訪問性支持
- 🎭 流暢的動畫效果

### 開發體驗

- 🔒 TypeScript 類型安全
- 🧪 完整的測試覆蓋
- 📝 清晰的代碼註釋
- 🔧 易於維護和擴展

---

## 🤝 貢獻指南

### 開發流程

1. Fork 本專案
2. 創建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 開啟 Pull Request

### 代碼規範

- 使用 TypeScript 編寫所有新代碼
- 遵循 ESLint 規則
- 編寫有意義的提交訊息
- 為新功能添加測試

---

## 📝 版本歷史

### v2.0 (2024-11-12)

**新增功能**:
- ✅ BU 切換搜尋功能
- ✅ 兩階段會員綁定機制
- ✅ 自動訂單轉移功能
- ✅ 跨轉單專員工作台
- ✅ 財務結算報表

**優化改進**:
- ✅ 流程簡化（7 步 → 4 步）
- ✅ 效率提升 90%+
- ✅ 用戶體驗大幅改善

### v1.0 (2024-03-25)

**初始版本**:
- 基本跨轉單功能
- 會員查詢與確認
- 消耗方操作介面
- 銷售方審核介面

---

## 📞 聯繫方式

- **專案負責人**: Cole
- **最後更新**: 2024-11-12
- **GitHub**: [Cross_Orders](https://github.com/colechengame/Cross_Order)

---

## 📄 授權

本專案僅供內部使用，請勿外傳。

---

## 🙏 致謝

感謝所有參與專案討論和開發的團隊成員：
- 營業部團隊（業務需求提供）
- IT 團隊（技術支持）
- 跨轉單專員（流程優化建議）
- 前線操作人員（用戶體驗反饋）

---

**Built with ❤️ using Next.js 15, React 19, and TypeScript**
